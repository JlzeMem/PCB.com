<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E2S PCB Pro - Advanced PCB Management</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- html2pdf.js for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        /* Custom styles to override or complement Tailwind, and for transitions */
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;
        }
        .light-theme {
            background: linear-gradient(to bottom right, #60a5fa, #a78bfa);
            color: #1f2937; /* Default text color for light theme */
        }
        .dark-theme {
            background-color: #1f2937; /* Dark background */
            color: #f3f4f6; /* Light text color */
        }
        .sidebar {
            width: 280px;
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.open {
            transform: translateX(0);
        }
        .sidebar.closed {
            transform: translateX(-100%);
        }
        .content-area {
            transition: opacity 0.3s ease-in-out;
        }
        .content-area.hidden-by-sidebar {
            opacity: 0;
            pointer-events: none;
        }
        /* Custom message box styles */
        .message-box-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .message-box {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 300px;
            width: 90%;
        }
        .message-box.dark-theme {
            background-color: #374151;
            color: #f3f4f6;
        }
        .message-box-success {
            color: #10b981;
        }
        .message-box-error {
            color: #ef4444;
        }
        .message-box-info {
            color: #3b82f6;
        }
    </style>
</head>
<body class="light-theme">
    <!-- Message Box Container -->
    <div id="messageBoxContainer" class="message-box-container hidden">
        <div id="messageBox" class="message-box">
            <p id="messageBoxText" class="text-lg font-semibold"></p>
            <button id="messageBoxCloseBtn" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">OK</button>
        </div>
    </div>

    <!-- Hamburger Menu Button -->
    <button id="hamburgerBtn" class="absolute top-4 left-4 p-3 rounded-full shadow-lg z-20 focus:outline-none focus:ring-2 bg-white text-gray-800 focus:ring-blue-500">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>

    <!-- Sidebar Menu -->
    <div id="sidebar" class="fixed top-0 left-0 h-full bg-gray-800 text-white p-6 shadow-xl z-30 transform -translate-x-full sidebar closed">
        <h2 class="text-2xl font-bold mb-6">Menu</h2>
        <nav>
            <ul>
                <li class="mb-4">
                    <a href="#" class="text-lg hover:text-blue-300 transition duration-200 block py-1" data-page="home">Home</a>
                </li>
                <li class="mb-4">
                    <a href="#" class="text-lg hover:text-blue-300 transition duration-200 block py-1" data-page="addPcb">Add PCB</a>
                </li>
                <li class="mb-4">
                    <a href="#" class="text-lg hover:text-blue-300 transition duration-200 block py-1" data-page="search">Search</a>
                </li>
                <li class="mb-4">
                    <a href="#" class="text-lg hover:text-blue-300 transition duration-200 block py-1" data-page="database">Database</a>
                </li>
                <li class="mb-4">
                    <a href="#" class="text-lg hover:text-blue-300 transition duration-200 block py-1" data-page="scanCompare">Scan/Compare</a>
                </li>
                <li class="mb-4">
                    <a href="#" class="text-lg hover:text-blue-300 transition duration-200 block py-1" data-page="settings">Settings</a>
                </li>
                <li class="mb-4">
                    <a href="#" class="text-lg hover:text-blue-300 transition duration-200 block py-1" data-page="appCreator">App Creator</a>
                </li>
                <li>
                    <a href="#" class="text-lg hover:text-blue-300 transition duration-200 block py-1" data-page="aboutUs">About Us</a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Overlay -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden"></div>

    <!-- Main Content Area -->
    <div id="content" class="min-h-screen flex flex-col items-center justify-center p-4 relative">
        <!-- Home Section -->
        <div id="homeSection" class="p-8 rounded-xl shadow-2xl text-center max-w-sm w-full z-10 content-area">
            <h1 class="text-4xl font-extrabold mb-4 animate-bounce">
                E2S PCB PRO
            </h1>
            <p class="text-lg mb-6">
                Advanced PCB management for your safety systems<br/>
                Worldwide availability - global approvals - 10 year warranty
            </p>
            <!-- Image Box -->
            <div class="mb-6 border-2 rounded-lg p-2 flex justify-center items-center h-48 overflow-hidden border-gray-300 bg-gray-100">
                <img id="homepageImageDisplay" src="https://placehold.co/400x200/cccccc/333333?text=E2S+Logo" alt="E2S Logo" class="max-w-full max-h-full object-contain rounded-lg shadow-md" />
            </div>
            <button id="searchPcbHomeBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                Search PCB
            </button>
        </div>

        <!-- Add PCB Section -->
        <div id="addPcbSection" class="p-8 rounded-xl shadow-2xl text-left w-full max-w-md mx-auto z-10 content-area hidden">
            <h2 class="text-3xl font-bold mb-6 text-center">Add New PCB</h2>

            <!-- Image Preview Box -->
            <div class="mb-6 border-2 rounded-lg p-2 flex flex-wrap justify-center items-center h-48 overflow-y-auto border-gray-300 bg-gray-100">
                <img id="pcbImagePreview" src="https://placehold.co/400x200/cccccc/333333?text=No+Image+Selected" alt="PCB Preview" class="max-w-full max-h-full object-contain rounded-lg shadow-md" />
            </div>

            <!-- PCB Name Section -->
            <div class="mb-4">
                <label for="pcbNameInput" class="block text-sm font-bold mb-2 text-gray-700">PCB Name:</label>
                <input type="text" id="pcbNameInput" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:ring-2 bg-white text-gray-700 border-gray-300 focus:ring-blue-500" placeholder="Enter PCB name" />
            </div>

            <!-- Take Photos (Camera) Section -->
            <div class="mb-4">
                <label for="cameraInput" class="block text-sm font-bold mb-2 text-gray-700">Take Photo (Camera):</label>
                <input type="file" id="cameraInput" accept="image/*" capture="camera" multiple class="block w-full text-sm border rounded-lg cursor-pointer p-2 focus:outline-none focus:ring-2 bg-gray-50 text-gray-900 border-gray-300 focus:ring-blue-500" />
            </div>

            <!-- Select from Gallery Section -->
            <div class="mb-4">
                <label for="galleryInput" class="block text-sm font-bold mb-2 text-gray-700">Select from Gallery:</label>
                <input type="file" id="galleryInput" accept="image/*" multiple class="block w-full text-sm border rounded-lg cursor-pointer p-2 focus:outline-none focus:ring-2 bg-gray-50 text-gray-900 border-gray-300 focus:ring-blue-500" />
            </div>

            <!-- Used By Family Section -->
            <div class="mb-4">
                <label for="usedByFamilyInput" class="block text-sm font-bold mb-2 text-gray-700">Used By Family:</label>
                <input type="text" id="usedByFamilyInput" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:ring-2 bg-white text-gray-700 border-gray-300 focus:ring-blue-500" placeholder="e.g., D1x, BEx, GNEx" />
            </div>

            <!-- Description Section -->
            <div class="mb-6">
                <label for="descriptionInput" class="block text-sm font-bold mb-2 text-gray-700">Description:</label>
                <textarea id="descriptionInput" rows="4" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline resize-none focus:ring-2 bg-white text-gray-700 border-gray-300 focus:ring-blue-500" placeholder="Add description for the PCB"></textarea>
            </div>

            <!-- Add PCB & Description Button -->
            <button id="addPcbBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 hover:scale-105 w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                Add PCB & Description
            </button>
        </div>

        <!-- Search Section -->
        <div id="searchSection" class="p-8 rounded-xl shadow-2xl text-left w-full max-w-md mx-auto z-10 content-area hidden">
            <h2 class="text-3xl font-bold mb-6 text-center">Search PCBs</h2>

            <!-- Search Text Box -->
            <div class="mb-6">
                <label for="searchQueryInput" class="block text-sm font-bold mb-2 text-gray-700">Search Query:</label>
                <input type="text" id="searchQueryInput" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:ring-2 bg-white text-gray-700 border-gray-300 focus:ring-blue-500" placeholder="Enter PCB name or description to search" />
            </div>

            <!-- Search Button -->
            <button id="searchBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 hover:scale-105 w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                Search
            </button>

            <!-- Placeholder for search results -->
            <div class="mt-8 text-center">
                <h3 class="text-xl font-semibold mb-4 text-gray-800">Search Results:</h3>
                <p class="text-gray-500">Results will appear here after search.</p>
            </div>
        </div>

        <!-- Database Section -->
        <div id="databaseSection" class="p-8 rounded-xl shadow-2xl text-center w-full max-w-4xl mx-auto z-10 content-area hidden">
            <h2 class="text-3xl font-bold mb-6 text-center">PCB DATABASE</h2>

            <div class="flex flex-col sm:flex-row justify-center gap-4 mb-8">
                <button id="generateCsvBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">
                    Generate .CSV
                </button>
                <button id="createPdfBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                    Create PDF Report
                </button>
                <button id="emailReportBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50">
                    Email Report
                </button>
            </div>

            <h3 class="text-2xl font-bold mb-4 text-gray-900">Current PCB Inventory</h3>
            <div id="pcbListContainer" class="overflow-x-auto rounded-lg shadow-md bg-white">
                <table class="min-w-full">
                    <thead>
                        <tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                            <th class="py-3 px-6 text-left">Image(s)</th>
                            <th class="py-3 px-6 text-left">PCB Name</th>
                            <th class="py-3 px-6 text-left">Description</th>
                            <th class="py-3 px-6 text-left">Used By Family</th>
                        </tr>
                    </thead>
                    <tbody id="pcbTableBody">
                        <!-- PCB rows will be dynamically inserted here -->
                    </tbody>
                </table>
                <p id="noPcbsMessage" class="text-gray-500 p-4 hidden">No PCBs added yet.</p>
            </div>
        </div>

        <!-- Scan/Compare Section -->
        <div id="scanCompareSection" class="p-8 rounded-xl shadow-2xl text-left w-full max-w-md mx-auto z-10 content-area hidden">
            <h2 class="text-3xl font-bold mb-6 text-center">Scan / Compare PCBs</h2>

            <!-- Image Holder -->
            <div class="mb-6 border-2 rounded-lg p-2 flex justify-center items-center h-48 overflow-hidden border-gray-300 bg-gray-100">
                <img id="scanCompareImagePreview" src="https://placehold.co/400x200/cccccc/333333?text=Upload+Image+for+Comparison" alt="PCB for Comparison" class="max-w-full max-h-full object-contain rounded-lg shadow-md" />
            </div>

            <!-- Choose File from Local Storage -->
            <div class="mb-6">
                <label for="scanCompareInput" class="block text-sm font-bold mb-2 text-gray-700">Choose Image File:</label>
                <input type="file" id="scanCompareInput" accept="image/*" class="block w-full text-sm border rounded-lg cursor-pointer p-2 focus:outline-none focus:ring-2 bg-gray-50 text-gray-900 border-gray-300 focus:ring-blue-500" />
            </div>

            <!-- Compare PCB Image with Database Button -->
            <button id="comparePcbBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 hover:scale-105 w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                Compare PCB Image with Database
            </button>

            <!-- Comparison Results Display Area -->
            <div id="comparisonResults" class="mt-8 p-4 rounded-lg shadow-inner text-left bg-gray-50 text-gray-700">
                <p class="text-gray-500 text-center">Comparison results will appear here.</p>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settingsSection" class="p-8 rounded-xl shadow-2xl text-center w-full max-w-sm mx-auto z-10 content-area hidden">
            <h2 class="text-3xl font-bold mb-6">Settings Section</h2>
            
            <!-- Theme Settings Section -->
            <div class="mb-6 p-4 rounded-lg shadow-md bg-gray-100 border border-gray-300">
                <h3 class="text-xl font-semibold mb-4 text-gray-800">Theme Settings</h3>
                <div class="flex justify-center gap-4">
                    <label class="inline-flex items-center cursor-pointer text-gray-700">
                        <input type="radio" class="form-radio h-5 w-5 text-blue-600" name="theme" value="light" checked />
                        <span class="ml-2">Light Mode</span>
                    </label>
                    <label class="inline-flex items-center cursor-pointer text-gray-700">
                        <input type="radio" class="form-radio h-5 w-5 text-blue-600" name="theme" value="dark" />
                        <span class="ml-2">Dark Mode</span>
                    </label>
                </div>
            </div>

            <!-- Homepage Image Section -->
            <div class="mb-6 p-4 rounded-lg shadow-md bg-gray-100 border border-gray-300">
                <h3 class="text-xl font-semibold mb-4 text-gray-800">Homepage Image</h3>
                
                <!-- Image Holder for Preview -->
                <div class="mb-4 border-2 rounded-lg p-2 flex justify-center items-center h-40 overflow-hidden border-gray-300 bg-white">
                    <img id="settingsHomepageImagePreview" src="https://placehold.co/300x150/cccccc/333333?text=Homepage+Preview" alt="Homepage Preview" class="max-w-full max-h-full object-contain rounded-lg shadow-md" />
                </div>

                <!-- Choose File Input -->
                <div class="mb-4">
                    <label for="homepageImageInput" class="block text-sm font-bold mb-2 text-gray-700">Choose Image File:</label>
                    <input type="file" id="homepageImageInput" accept="image/*" class="block w-full text-sm border rounded-lg cursor-pointer p-2 focus:outline-none focus:ring-2 bg-gray-50 text-gray-900 border-gray-300 focus:ring-blue-500" />
                </div>

                <!-- Set Homepage Image Button -->
                <button id="setHomepageImageBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 hover:scale-105 w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                    Set Homepage Image
                </button>

                <!-- Status Message Display -->
                <div id="homepageImageStatusMessage" class="mt-4 p-3 rounded-lg text-sm font-semibold hidden"></div>
            </div>

            <!-- Data Management Section -->
            <div class="mb-6 p-4 rounded-lg shadow-md bg-gray-100 border border-gray-300">
                <h3 class="text-xl font-semibold mb-4 text-gray-800">Data Management</h3>
                
                <!-- Export Database -->
                <button id="exportCsvBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 hover:scale-105 w-full mb-4 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">
                    Export Database to CSV
                </button>

                <!-- Import Database -->
                <div class="mb-4">
                    <label for="importFileInput" class="block text-sm font-bold mb-2 text-gray-700">Import Database from CSV:</label>
                    <input type="file" id="importFileInput" accept=".csv" class="block w-full text-sm border rounded-lg cursor-pointer p-2 focus:outline-none focus:ring-2 bg-gray-50 text-gray-900 border-gray-300 focus:ring-blue-500" />
                </div>
                <button id="importDataBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 hover:scale-105 w-full focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50">
                    Import Data
                </button>

                <!-- Import Status Message Display -->
                <div id="importStatusMessage" class="mt-4 p-3 rounded-lg text-sm font-semibold hidden"></div>
            </div>

            <!-- Delete Database Section -->
            <div class="mb-6 p-4 rounded-lg shadow-md bg-gray-100 border border-gray-300">
                <h3 class="text-xl font-semibold mb-4 text-gray-800">Delete Database</h3>
                
                <button id="deleteDataPromptBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 hover:scale-105 w-full focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50">
                    Delete All Data
                </button>
                
                <div id="deleteConfirmationArea" class="flex flex-col items-center hidden">
                    <p id="deleteConfirmationMessage" class="mb-4 text-sm font-medium text-red-700"></p>
                    <button id="confirmDeleteBtn" class="bg-red-800 hover:bg-red-900 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform transition duration-300 hover:scale-105 w-full focus:outline-none focus:ring-2 focus:ring-red-700 focus:ring-opacity-50">
                        Confirm Delete Database
                    </button>
                    <button id="cancelDeleteBtn" class="mt-2 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transform transition duration-300 hover:scale-105 w-full focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50">
                        Cancel
                    </button>
                </div>

                <!-- Delete Status Message Display -->
                <div id="deleteStatusMessage" class="mt-4 p-3 rounded-lg text-sm font-semibold hidden"></div>
            </div>

            <p class="text-gray-700 mt-4">Other application settings will go here.</p>
        </div>

        <!-- App Creator Section -->
        <div id="appCreatorSection" class="p-8 rounded-xl shadow-2xl text-center max-w-sm w-full z-10 content-area hidden">
            <h2 class="text-3xl font-bold mb-6">App Creator Section</h2>
            <p class="text-gray-700 mt-4">
                This app is created by <span class="text-xl font-bold transition-transform duration-300 hover:scale-105 inline-block">Joel Menezes</span>
            </p>
        </div>

        <!-- About Us Section -->
        <div id="aboutUsSection" class="p-8 rounded-xl shadow-2xl text-left w-full max-w-md mx-auto z-10 content-area hidden">
            <h2 class="text-3xl font-bold mb-6 text-center">E2S Warning Signals</h2>
            
            <!-- About Us Collapsible Section -->
            <div id="aboutUsCollapsible" class="mb-4 p-4 rounded-lg shadow-md cursor-pointer bg-gray-100 border border-gray-300">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-semibold text-gray-800">About Us</h3>
                    <svg class="w-6 h-6 transform transition-transform duration-300" data-toggle-svg="aboutUs" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                <div id="aboutUsContent" class="overflow-hidden transition-all duration-500 ease-in-out max-h-0 opacity-0">
                    <p class="text-gray-700 mt-2">
                        E2S is the worldâ€™s leading independent signalling manufacturer. We specialise in the design, development and manufacture of high performance audible and visual signals for commercial, industrial, marine and hazardous locations with over 30 years of expertise. Our head office and manufacturing operations are located in London, UK with extensive facilities for design, manufacture, quality assurance, testing and dispatch along with a customer service centre serving global markets. Additionally, a dedicated distribution hub and sales operation is based in Houston, Texas principally serving North and South American customers as well as supporting projects globally. An international network of distribution partners and system integrators ensure worldwide product availability and local technical support.
                    </p>
                </div>
            </div>

            <!-- Serving your sector Collapsible Section -->
            <div id="servingSectorCollapsible" class="mb-4 p-4 rounded-lg shadow-md cursor-pointer bg-gray-100 border border-gray-300">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-semibold text-gray-800">Serving your sector</h3>
                    <svg class="w-6 h-6 transform transition-transform duration-300" data-toggle-svg="servingSector" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                <div id="servingSectorContent" class="overflow-hidden transition-all duration-500 ease-in-out max-h-0 opacity-0">
                    <p class="text-gray-700 mt-2">
                        We believe that technical excellence can be achieved through sharing best practice and understanding the requirements of each sector. Our products have proven performance and we can offer standard and bespoke solutions to diverse applications combined with dedicated expert advice. Our signalling equipment can be utilized in a vast range of sectors and applications including: Energy: on and off shore extraction and processing & storage Mining: surface & sub-surface Marine: on board and land based infrastructure Chemical: manufacturing & storage Transportation: rail & material handling General industrial: process control and safety Should you have a specific query about product applications, please contact us with your requirements.
                    </p>
                </div>
            </div>

            <!-- Product Development Collapsible Section -->
            <div id="productDevelopmentCollapsible" class="mb-4 p-4 rounded-lg shadow-md cursor-pointer bg-gray-100 border border-gray-300">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-semibold text-gray-800">Product Development</h3>
                    <svg class="w-6 h-6 transform transition-transform duration-300" data-toggle-svg="productDevelopment" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                <div id="productDevelopmentContent" class="overflow-hidden transition-all duration-500 ease-in-out max-h-0 opacity-0">
                    <p class="text-gray-700 mt-2">
                        We are committed to collaborative research and product development. Underpinning our product development strategy is a close collaboration with our customers ensuring we create effective and functional products to meet your needs and those of ever changing markets.
                        <br/><br/>
                        Working together with system integrators, engineers, specifiers and clients we have developed product solutions to precise requirements with substantiated benefits such as ease of interface, installation, programming and overall performance that all our customers can benefit from every day.
                        <br/><br/>
                        Additionally, we have a long history of manufacturing products to specific requirements including alarm tone frequencies, tone patterns, stage configurations and housing colours. Please contact us with your requirements today.
                    </p>
                    <p class="text-gray-700 font-bold mt-4">Hazardous Area</p>
                    <p class="text-gray-700">Browse by type:</p>
                    <ul class="list-disc list-inside ml-4 mt-2 text-gray-700">
                        <li>Visual</li>
                        <li>Audible</li>
                        <li>Combination</li>
                        <li>Alarm Bars</li>
                        <li>Status Lamps</li>
                        <li>Manual Call Points</li>
                        <li>Junction Boxes</li>
                        <li>Detectors</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const body = document.body;
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const navLinks = sidebar.querySelectorAll('a[data-page]');
        const contentSections = document.querySelectorAll('.content-area');

        // Message Box Elements
        const messageBoxContainer = document.getElementById('messageBoxContainer');
        const messageBox = document.getElementById('messageBox');
        const messageBoxText = document.getElementById('messageBoxText');
        const messageBoxCloseBtn = document.getElementById('messageBoxCloseBtn');

        // Home Section Elements
        const homeSection = document.getElementById('homeSection');
        const homepageImageDisplay = document.getElementById('homepageImageDisplay');
        const searchPcbHomeBtn = document.getElementById('searchPcbHomeBtn');

        // Add PCB Section Elements
        const addPcbSection = document.getElementById('addPcbSection');
        const pcbImagePreview = document.getElementById('pcbImagePreview');
        const pcbNameInput = document.getElementById('pcbNameInput');
        const cameraInput = document.getElementById('cameraInput');
        const galleryInput = document.getElementById('galleryInput');
        const usedByFamilyInput = document.getElementById('usedByFamilyInput');
        const descriptionInput = document.getElementById('descriptionInput');
        const addPcbBtn = document.getElementById('addPcbBtn');

        // Search Section Elements
        const searchSection = document.getElementById('searchSection');
        const searchQueryInput = document.getElementById('searchQueryInput');
        const searchBtn = document.getElementById('searchBtn');

        // Database Section Elements
        const databaseSection = document.getElementById('databaseSection');
        const generateCsvBtn = document.getElementById('generateCsvBtn');
        const createPdfBtn = document.getElementById('createPdfBtn');
        const emailReportBtn = document.getElementById('emailReportBtn');
        const pcbTableBody = document.getElementById('pcbTableBody');
        const noPcbsMessage = document.getElementById('noPcbsMessage');

        // Scan/Compare Section Elements
        const scanCompareSection = document.getElementById('scanCompareSection');
        const scanCompareImagePreview = document.getElementById('scanCompareImagePreview');
        const scanCompareInput = document.getElementById('scanCompareInput');
        const comparePcbBtn = document.getElementById('comparePcbBtn');
        const comparisonResultsDiv = document.getElementById('comparisonResults');

        // Settings Section Elements
        const settingsSection = document.getElementById('settingsSection');
        const themeRadios = document.querySelectorAll('input[name="theme"]');
        const settingsHomepageImagePreview = document.getElementById('settingsHomepageImagePreview');
        const homepageImageInput = document.getElementById('homepageImageInput');
        const setHomepageImageBtn = document.getElementById('setHomepageImageBtn');
        const homepageImageStatusMessage = document.getElementById('homepageImageStatusMessage');
        const exportCsvBtn = document.getElementById('exportCsvBtn');
        const importFileInput = document.getElementById('importFileInput');
        const importDataBtn = document.getElementById('importDataBtn');
        const importStatusMessage = document.getElementById('importStatusMessage');
        const deleteDataPromptBtn = document.getElementById('deleteDataPromptBtn');
        const deleteConfirmationArea = document.getElementById('deleteConfirmationArea');
        const deleteConfirmationMessage = document.getElementById('deleteConfirmationMessage');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const deleteStatusMessage = document.getElementById('deleteStatusMessage');

        // App Creator Section Elements
        const appCreatorSection = document.getElementById('appCreatorSection');

        // About Us Section Elements
        const aboutUsSection = document.getElementById('aboutUsSection');
        const aboutUsCollapsible = document.getElementById('aboutUsCollapsible');
        const aboutUsContent = document.getElementById('aboutUsContent');
        const servingSectorCollapsible = document.getElementById('servingSectorCollapsible');
        const servingSectorContent = document.getElementById('servingSectorContent');
        const productDevelopmentCollapsible = document.getElementById('productDevelopmentCollapsible');
        const productDevelopmentContent = document.getElementById('productDevelopmentContent');
        const collapsibleSvgs = document.querySelectorAll('[data-toggle-svg]');


        // Global State Variables
        let pcbs = [];
        let currentTheme = 'light';
        let homepageImage = null;
        let tempHomepageImage = null;
        let importFile = null;
        let showDeleteConfirmation = false;

        // --- Utility Functions ---

        /**
         * Shows a custom message box.
         * @param {string} message - The message to display.
         * @param {string} type - 'success', 'error', or 'info' for styling.
         */
        function showMessage(message, type) {
            messageBoxText.textContent = message;
            messageBoxText.className = 'text-lg font-semibold'; // Reset classes
            messageBox.className = 'message-box'; // Reset classes

            if (type === 'success') {
                messageBoxText.classList.add('message-box-success');
            } else if (type === 'error') {
                messageBoxText.classList.add('message-box-error');
            } else if (type === 'info') {
                messageBoxText.classList.add('message-box-info');
            }

            if (currentTheme === 'dark') {
                messageBox.classList.add('dark-theme');
            } else {
                messageBox.classList.remove('dark-theme');
            }

            messageBoxContainer.classList.remove('hidden');
        }

        /**
         * Hides the custom message box.
         */
        function hideMessage() {
            messageBoxContainer.classList.add('hidden');
        }

        /**
         * Applies the selected theme to the body and other elements.
         * @param {string} themeName - 'light' or 'dark'.
         */
        function applyTheme(themeName) {
            body.classList.remove('light-theme', 'dark-theme');
            body.classList.add(`${themeName}-theme`);
            currentTheme = themeName;
            localStorage.setItem('appTheme', themeName);

            // Helper to safely add/remove multiple classes
            const updateElementTheme = (element, darkClasses, lightClasses) => {
                if (!element) return;
                const darkClassArray = darkClasses.split(' ');
                const lightClassArray = lightClasses.split(' ');

                if (themeName === 'dark') {
                    element.classList.remove(...lightClassArray);
                    element.classList.add(...darkClassArray);
                } else {
                    element.classList.remove(...darkClassArray);
                    element.classList.add(...lightClassArray);
                }
            };

            // Main content area
            contentSections.forEach(section => {
                updateElementTheme(section, 'bg-gray-700 text-gray-100', 'bg-white text-gray-900');
            });

            // Hamburger button
            updateElementTheme(hamburgerBtn, 'bg-gray-700 text-gray-100 focus:ring-blue-300', 'bg-white text-gray-800 focus:ring-blue-500');

            // Add PCB section elements
            updateElementTheme(pcbNameInput, 'bg-gray-800 text-gray-100 border-gray-600 focus:ring-blue-300', 'bg-white text-gray-700 border-gray-300 focus:ring-blue-500');
            updateElementTheme(cameraInput, 'bg-gray-800 text-gray-100 border-gray-600 focus:ring-blue-300', 'bg-gray-50 text-gray-900 border-gray-300 focus:ring-blue-500');
            updateElementTheme(galleryInput, 'bg-gray-800 text-gray-100 border-gray-600 focus:ring-blue-300', 'bg-gray-50 text-gray-900 border-gray-300 focus:ring-blue-500');
            updateElementTheme(usedByFamilyInput, 'bg-gray-800 text-gray-100 border-gray-600 focus:ring-blue-300', 'bg-white text-gray-700 border-gray-300 focus:ring-blue-500');
            updateElementTheme(descriptionInput, 'bg-gray-800 text-gray-100 border-gray-600 focus:ring-blue-300', 'bg-white text-gray-700 border-gray-300 focus:ring-blue-500');
            
            // Search section elements
            updateElementTheme(searchQueryInput, 'bg-gray-800 text-gray-100 border-gray-600 focus:ring-blue-300', 'bg-white text-gray-700 border-gray-300 focus:ring-blue-500');
            document.querySelector('#searchSection h3').classList.toggle('text-gray-100', themeName === 'dark');
            document.querySelector('#searchSection h3').classList.toggle('text-gray-800', themeName === 'light');
            document.querySelector('#searchSection p').classList.toggle('text-gray-400', themeName === 'dark');
            document.querySelector('#searchSection p').classList.toggle('text-gray-500', themeName === 'light');

            // Database section elements
            document.querySelector('#databaseSection h3').classList.toggle('text-gray-100', themeName === 'dark');
            document.querySelector('#databaseSection h3').classList.toggle('text-gray-900', themeName === 'light');
            updateElementTheme(pcbListContainer, 'bg-gray-800', 'bg-white');
            updateElementTheme(noPcbsMessage, 'text-gray-400', 'text-gray-500');

            // Table headers
            const tableHeaderRow = document.querySelector('#pcbListContainer thead tr');
            if (tableHeaderRow) {
                tableHeaderRow.classList.toggle('bg-gray-600', themeName === 'dark');
                tableHeaderRow.classList.toggle('text-gray-100', themeName === 'dark');
                tableHeaderRow.classList.toggle('bg-gray-100', themeName === 'light');
                tableHeaderRow.classList.toggle('text-gray-600', themeName === 'light');
            }
            // Table rows
            document.querySelectorAll('#pcbTableBody tr').forEach(row => {
                row.classList.toggle('border-gray-600', themeName === 'dark');
                row.classList.toggle('border-gray-200', themeName === 'light');
                row.classList.toggle('hover:bg-gray-600', themeName === 'dark');
                row.classList.toggle('hover:bg-gray-100', themeName === 'light');
                row.querySelectorAll('td span').forEach(span => {
                    span.classList.toggle('text-gray-400', themeName === 'dark');
                    span.classList.toggle('text-gray-500', themeName === 'light');
                });
            });


            // Scan/Compare section elements
            updateElementTheme(scanCompareInput, 'bg-gray-800 text-gray-100 border-gray-600 focus:ring-blue-300', 'bg-gray-50 text-gray-900 border-gray-300 focus:ring-blue-500');
            updateElementTheme(comparisonResultsDiv, 'bg-gray-800 text-gray-100', 'bg-gray-50 text-gray-700');
            document.querySelector('#scanCompareSection .text-gray-500').classList.toggle('text-gray-400', themeName === 'dark');
            document.querySelector('#scanCompareSection .text-gray-500').classList.toggle('text-gray-500', themeName === 'light');


            // Settings section elements
            document.querySelectorAll('#settingsSection h3').forEach(h3 => {
                h3.classList.toggle('text-gray-100', themeName === 'dark');
                h3.classList.toggle('text-gray-800', themeName === 'light');
            });
            document.querySelectorAll('#settingsSection > div').forEach(div => {
                updateElementTheme(div, 'bg-gray-800 border border-gray-600', 'bg-gray-100 border border-gray-300');
            });
            document.querySelectorAll('input[name="theme"] + span').forEach(span => {
                span.classList.toggle('text-gray-100', themeName === 'dark');
                span.classList.toggle('text-gray-700', themeName === 'light');
            });
            updateElementTheme(homepageImageInput, 'bg-gray-900 text-gray-100 border-gray-600 focus:ring-blue-300', 'bg-gray-50 text-gray-900 border-gray-300 focus:ring-blue-500');
            updateElementTheme(importFileInput, 'bg-gray-900 text-gray-100 border-gray-600 focus:ring-blue-300', 'bg-gray-50 text-gray-900 border-gray-300 focus:ring-blue-500');
            document.querySelector('#deleteConfirmationArea p').classList.toggle('text-red-300', themeName === 'dark');
            document.querySelector('#deleteConfirmationArea p').classList.toggle('text-red-700', themeName === 'light');
            document.querySelector('#settingsSection > p').classList.toggle('text-gray-400', themeName === 'dark');
            document.querySelector('#settingsSection > p').classList.toggle('text-gray-700', themeName === 'light');

            // About Us section elements
            document.querySelector('#aboutUsSection h2').classList.toggle('text-gray-100', themeName === 'dark');
            document.querySelector('#aboutUsSection h2').classList.toggle('text-gray-900', themeName === 'light');
            document.querySelectorAll('#aboutUsSection h3').forEach(h3 => {
                h3.classList.toggle('text-gray-100', themeName === 'dark');
                h3.classList.toggle('text-gray-800', themeName === 'light');
            });
            document.querySelectorAll('#aboutUsSection > div').forEach(div => {
                updateElementTheme(div, 'bg-gray-800 border border-gray-600', 'bg-gray-100 border border-gray-300');
            });
            document.querySelectorAll('#aboutUsSection p').forEach(p => {
                p.classList.toggle('text-gray-300', themeName === 'dark');
                p.classList.toggle('text-gray-700', themeName === 'light');
            });
            document.querySelectorAll('#aboutUsSection li').forEach(li => {
                li.classList.toggle('text-gray-300', themeName === 'dark');
                li.classList.toggle('text-gray-700', themeName === 'light');
            });
        }

        /**
         * Shows a specific content section and hides others.
         * @param {HTMLElement} sectionToShow - The section element to make visible.
         */
        function showSection(sectionToShow) {
            contentSections.forEach(section => {
                section.classList.add('hidden');
                section.classList.add('opacity-0');
                section.classList.add('pointer-events-none');
            });
            sectionToShow.classList.remove('hidden');
            // Trigger reflow to ensure transition plays
            void sectionToShow.offsetWidth; 
            sectionToShow.classList.remove('opacity-0');
            sectionToShow.classList.remove('pointer-events-none');

            // Reset form fields and states when navigating
            resetFormsAndStates(sectionToShow.id);
        }

        /**
         * Resets form fields and relevant states based on the current section.
         * @param {string} currentSectionId - The ID of the section being navigated to.
         */
        function resetFormsAndStates(currentSectionId) {
            // Reset Add PCB form
            if (currentSectionId !== 'addPcbSection') {
                pcbNameInput.value = '';
                descriptionInput.value = '';
                cameraInput.value = '';
                galleryInput.value = '';
                usedByFamilyInput.value = '';
                pcbImagePreview.src = "https://placehold.co/400x200/cccccc/333333?text=No+Image+Selected";
                pcbImagePreview.classList.remove('hidden'); // Ensure it's visible if it was hidden
                // Clear multiple image previews
                const existingPreviews = pcbImagePreview.parentNode.querySelectorAll('img:not(#pcbImagePreview)');
                existingPreviews.forEach(img => img.remove());
                // This line was problematic in HTML as `pcbs` is a global array, not a React state.
                // It was trying to map over `pcbs` and modify it, which isn't how image previews
                // are managed in a pure JS context. Removing this line as it's not needed for HTML
                // and caused issues. The image preview logic is handled directly in `handleImageChange`.
                // pcbs = pcbs.map(pcb => ({ ...pcb, images: [] })); 
            }

            // Reset Search form
            if (currentSectionId !== 'searchSection') {
                searchQueryInput.value = '';
            }

            // Reset Scan/Compare form
            if (currentSectionId !== 'scanCompareSection') {
                scanCompareImagePreview.src = "https://placehold.co/400x200/cccccc/333333?text=Upload+Image+for+Comparison";
                scanCompareInput.value = '';
                comparisonResultsDiv.innerHTML = `<p class="text-gray-500 text-center ${currentTheme === 'dark' ? 'text-gray-400' : ''}">Comparison results will appear here.</p>`;
            }

            // Reset Settings form
            if (currentSectionId !== 'settingsSection') {
                settingsHomepageImagePreview.src = homepageImage || "https://placehold.co/300x150/cccccc/333333?text=Homepage+Preview";
                homepageImageInput.value = '';
                homepageImageStatusMessage.classList.add('hidden');
                homepageImageStatusMessage.textContent = '';
                importFileInput.value = '';
                importStatusMessage.classList.add('hidden');
                importStatusMessage.textContent = '';
                deleteConfirmationArea.classList.add('hidden');
                deleteStatusMessage.classList.add('hidden');
                deleteStatusMessage.textContent = '';
                showDeleteConfirmation = false;
            }

            // Reset About Us collapsible sections
            if (currentSectionId !== 'aboutUsSection') {
                // Collapse all sections if not on the About Us page
                aboutUsContent.style.maxHeight = '0';
                aboutUsContent.style.opacity = '0';
                document.querySelector('#aboutUsCollapsible [data-toggle-svg="aboutUs"]').classList.remove('rotate-180');

                servingSectorContent.style.maxHeight = '0';
                servingSectorContent.style.opacity = '0';
                document.querySelector('#servingSectorCollapsible [data-toggle-svg="servingSector"]').classList.remove('rotate-180');

                productDevelopmentContent.style.maxHeight = '0';
                productDevelopmentContent.style.opacity = '0';
                document.querySelector('#productDevelopmentCollapsible [data-toggle-svg="productDevelopment"]').classList.remove('rotate-180');
            }
        }

        /**
         * Toggles the visibility of the sidebar.
         */
        function toggleSidebar() {
            sidebar.classList.toggle('closed');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('hidden');
            contentSections.forEach(section => {
                section.classList.toggle('hidden-by-sidebar');
            });

            // Update theme-dependent classes for hamburger button when sidebar state changes
            if (sidebar.classList.contains('open')) {
                hamburgerBtn.classList.remove('bg-white', 'text-gray-800', 'focus:ring-blue-500');
                hamburgerBtn.classList.add('bg-gray-700', 'text-gray-100', 'focus:ring-blue-300');
            } else {
                if (currentTheme === 'light') {
                    hamburgerBtn.classList.remove('bg-gray-700', 'text-gray-100', 'focus:ring-blue-300');
                    hamburgerBtn.classList.add('bg-white', 'text-gray-800', 'focus:ring-blue-500');
                } else {
                    hamburgerBtn.classList.remove('bg-white', 'text-gray-800', 'focus:ring-blue-500');
                    hamburgerBtn.classList.add('bg-gray-700', 'text-gray-100', 'focus:ring-blue-300');
                }
            }
        }

        /**
         * Refreshes the PCB list displayed in the Database tab.
         */
        function refreshPcbList() {
            pcbTableBody.innerHTML = ''; // Clear existing rows
            if (pcbs.length === 0) {
                noPcbsMessage.classList.remove('hidden');
                pcbListContainer.classList.add('hidden'); // Hide table if no PCBs
            } else {
                noPcbsMessage.classList.add('hidden');
                pcbListContainer.classList.remove('hidden'); // Show table if PCBs exist
                pcbs.forEach(pcb => {
                    const row = document.createElement('tr');
                    row.className = `border-b ${currentTheme === 'dark' ? 'border-gray-600' : 'border-gray-200'} ${currentTheme === 'dark' ? 'hover:bg-gray-600' : 'hover:bg-gray-100'}`;
                    
                    const imageCell = `
                        <td class="py-3 px-6 text-left">
                            <div class="flex flex-wrap gap-1">
                                ${pcb.images && pcb.images.length > 0 ? 
                                    pcb.images.map((imgSrc, idx) => `<img src="${imgSrc}" alt="${pcb.name} ${idx + 1}" class="w-12 h-12 object-cover rounded-md" />`).join('') : 
                                    `<span class="${currentTheme === 'dark' ? 'text-gray-400' : 'text-gray-500'}">No Image</span>`}
                            </div>
                        </td>
                    `;

                    row.innerHTML = `
                        ${imageCell}
                        <td class="py-3 px-6 text-left">${pcb.name || 'N/A'}</td>
                        <td class="py-3 px-6 text-left">${pcb.description || 'N/A'}</td>
                        <td class="py-3 px-6 text-left">${pcb.usedByFamily || 'N/A'}</td>
                    `;
                    pcbTableBody.appendChild(row);
                });
            }
        }

        /**
         * Loads the saved homepage image from local storage.
         */
        function updateHomepageImage() {
            const savedHomepageImage = localStorage.getItem('homepageImage');
            if (savedHomepageImage) {
                homepageImage = savedHomepageImage;
                homepageImageDisplay.src = savedHomepageImage;
                settingsHomepageImagePreview.src = savedHomepageImage;
            } else {
                homepageImage = null;
                homepageImageDisplay.src = "https://placehold.co/400x200/cccccc/333333?text=E2S+Logo";
                settingsHomepageImagePreview.src = "https://placehold.co/300x150/cccccc/333333?text=Homepage+Preview";
            }
        }

        /**
         * Helper function to trigger file download or Web Share API.
         * @param {Blob} fileBlob - The Blob object of the file to share/download.
         * @param {string} fileName - The desired file name.
         * @param {string} title - Title for Web Share API.
         * @param {string} text - Text for Web Share API.
         */
        async function shareOrDownloadFile(fileBlob, fileName, title, text) {
            if (navigator.share && navigator.canShare && navigator.canShare({ files: [new File([], fileName, { type: fileBlob.type })] })) {
                try {
                    const file = new File([fileBlob], fileName, { type: fileBlob.type });
                    await navigator.share({
                        files: [file],
                        title: title,
                        text: text,
                    });
                    showMessage('File shared successfully!', 'success');
                } catch (error) {
                    console.error('Error sharing file:', error);
                    showMessage('Error sharing file: ' + error.message, 'error');
                }
            } else {
                // Fallback for download if Web Share API is not available
                const link = document.createElement('a');
                link.href = URL.createObjectURL(fileBlob);
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href); // Clean up the URL object
                showMessage('File downloaded successfully!', 'info');
            }
        }

        /**
         * Parses CSV text into an array of PCB objects.
         * @param {string} csvText - The CSV content as a string.
         * @returns {Array<Object>} An array of PCB objects.
         */
        function parseCsv(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            if (lines.length < 2) {
                throw new Error('CSV file is empty or malformed (requires header + data).');
            }

            const header = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
            const dataLines = lines.slice(1);

            const parsedData = dataLines.map(line => {
                const values = line.match(/(".*?"|[^",]+)(,|$)/g).map(val => 
                    val.replace(/,$/, '').replace(/^"|"$/g, '').replace(/""/g, '"').trim()
                );
                
                const pcb = {};
                header.forEach((key, index) => {
                    if (key === "Images (Base64)") {
                        pcb.images = values[index] ? values[index].split(' | ').filter(img => img) : [];
                    } else {
                        pcb[key.toLowerCase().replace(/\s\(base64\)/, '').replace(/\s/g, '')] = values[index];
                    }
                });
                pcb.id = Date.now() + Math.random(); 
                return pcb;
            });
            return parsedData;
        }

        // --- Event Listeners and Initial Load ---

        document.addEventListener('DOMContentLoaded', () => {
            // Load saved theme
            const savedTheme = localStorage.getItem('appTheme');
            if (savedTheme) {
                applyTheme(savedTheme);
                // Set radio button state
                themeRadios.forEach(radio => {
                    if (radio.value === savedTheme) {
                        radio.checked = true;
                    }
                });
            } else {
                applyTheme('light'); // Default theme
            }

            // Load saved PCBs
            const savedPcbs = localStorage.getItem('pcbs');
            if (savedPcbs) {
                pcbs = JSON.parse(savedPcbs);
            }

            updateHomepageImage(); // Load saved homepage image
            showSection(homeSection); // Show home section by default
        });

        // Sidebar Toggling
        hamburgerBtn.addEventListener('click', toggleSidebar);
        overlay.addEventListener('click', toggleSidebar);

        // Navigation Links
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = e.target.dataset.page;
                let sectionToShow;
                switch (page) {
                    case 'home': sectionToShow = homeSection; break;
                    case 'addPcb': sectionToShow = addPcbSection; break;
                    case 'search': sectionToShow = searchSection; break;
                    case 'database': 
                        sectionToShow = databaseSection; 
                        refreshPcbList(); // Refresh list when navigating to Database
                        break;
                    case 'scanCompare': sectionToShow = scanCompareSection; break;
                    case 'settings': sectionToShow = settingsSection; break;
                    case 'appCreator': sectionToShow = appCreatorSection; break;
                    case 'aboutUs': sectionToShow = aboutUsSection; break;
                    default: sectionToShow = homeSection;
                }
                showSection(sectionToShow);
                toggleSidebar(); // Close sidebar after navigation
            });
        });

        // Message Box Close Button
        messageBoxCloseBtn.addEventListener('click', hideMessage);

        // Home Section Search PCB Button
        searchPcbHomeBtn.addEventListener('click', () => {
            showSection(searchSection);
        });

        // Add PCB Section - Image Input
        cameraInput.addEventListener('change', (event) => handleImageChange(event, pcbImagePreview));
        galleryInput.addEventListener('change', (event) => handleImageChange(event, pcbImagePreview));

        function handleImageChange(event, previewElement) {
            const files = Array.from(event.target.files);
            if (files.length > 0) {
                // Clear previous single image preview if it's the default placeholder
                if (previewElement.id === 'pcbImagePreview' && previewElement.src.includes('No+Image+Selected')) {
                    previewElement.classList.add('hidden'); // Hide the default placeholder
                }
                
                // Clear existing dynamic image previews
                const existingPreviews = previewElement.parentNode.querySelectorAll('img:not(#pcbImagePreview)');
                existingPreviews.forEach(img => img.remove());

                const newImages = [];
                let filesProcessed = 0;

                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        newImages.push(reader.result);
                        filesProcessed++;
                        if (filesProcessed === files.length) {
                            // Add new images to the DOM for preview
                            newImages.forEach(imgSrc => {
                                const img = document.createElement('img');
                                img.src = imgSrc;
                                img.alt = "PCB Preview";
                                img.className = "w-20 h-20 object-contain rounded-md m-1 shadow-sm";
                                previewElement.parentNode.appendChild(img);
                            });
                            // No direct state update like React's `setPcbImages` here.
                            // The images will be collected from the DOM when `addPcbBtn` is clicked.
                        }
                    };
                    reader.readAsDataURL(file);
                });
            }
        }


        // Add PCB Button
        addPcbBtn.addEventListener('click', () => {
            const name = pcbNameInput.value.trim();
            const description = descriptionInput.value.trim();
            const family = usedByFamilyInput.value.trim();
            
            // Collect all image sources from the preview area (excluding the placeholder)
            const images = Array.from(pcbImagePreview.parentNode.querySelectorAll('img')).map(img => img.src).filter(src => !src.includes('No+Image+Selected'));

            if (!name || !description || images.length === 0 || !family) {
                showMessage('Please fill in all fields and select at least one image.', 'error');
                return;
            }

            const newPcb = {
                id: Date.now(),
                name: name,
                description: description,
                images: images,
                usedByFamily: family,
            };

            pcbs.push(newPcb);
            localStorage.setItem('pcbs', JSON.stringify(pcbs)); // Save to local storage
            showMessage('PCB & Description Added!', 'success');

            // Clear form
            pcbNameInput.value = '';
            descriptionInput.value = '';
            cameraInput.value = '';
            galleryInput.value = '';
            usedByFamilyInput.value = '';
            pcbImagePreview.src = "https://placehold.co/400x200/cccccc/333333?text=No+Image+Selected";
            pcbImagePreview.classList.remove('hidden'); // Ensure it's visible if it was hidden
            const existingPreviews = pcbImagePreview.parentNode.querySelectorAll('img:not(#pcbImagePreview)');
            existingPreviews.forEach(img => img.remove());
        });

        // Search Section - Search Button
        searchBtn.addEventListener('click', () => {
            const query = searchQueryInput.value.trim();
            showMessage(`Searching for: ${query}`, 'info');
            // Implement actual search logic here (e.g., filter 'pcbs' array)
        });

        // Scan/Compare Section - Image Input
        scanCompareInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onloadend = () => {
                    scanCompareImagePreview.src = reader.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Scan/Compare Section - Compare Button
        comparePcbBtn.addEventListener('click', () => {
            const selectedImageSrc = scanCompareImagePreview.src;
            if (selectedImageSrc.includes('Upload+Image+for+Comparison')) {
                showMessage('Please select an image to compare.', 'error');
                comparisonResultsDiv.innerHTML = `<p class="text-gray-500 text-center ${currentTheme === 'dark' ? 'text-gray-400' : ''}">Comparison results will appear here.</p>`;
                return;
            }

            comparisonResultsDiv.innerHTML = `<p class="${currentTheme === 'dark' ? 'text-gray-300' : 'text-gray-700'}">Comparing image with database...</p>`;

            if (pcbs.length === 0) {
                comparisonResultsDiv.innerHTML = `<p class="text-red-500">No PCBs in the database to compare against.</p>`;
                return;
            }

            let resultsHtml = `<h3 class="text-xl font-semibold ${currentTheme === 'dark' ? 'text-gray-100' : 'text-gray-800'} mb-2">Comparison Results:</h3>`;
            let foundMatches = false;

            pcbs.forEach(pcb => {
                foundMatches = true; // Always true if there are PCBs in the database
                resultsHtml += `
                    <div class="border border-gray-300 rounded-lg p-4 mb-4 ${currentTheme === 'dark' ? 'bg-gray-600 text-gray-100' : 'bg-gray-50 text-gray-700'}">
                        <h4 class="font-bold text-lg ${currentTheme === 'dark' ? 'text-blue-300' : 'text-blue-700'}">${pcb.name} (Used by: ${pcb.usedByFamily})</h4>
                        <p class="text-sm ${currentTheme === 'dark' ? 'text-gray-200' : 'text-gray-600'} mb-2">Description: ${pcb.description || 'N/A'}</p>
                        <div class="flex justify-center mt-2">
                            ${pcb.images && pcb.images.length > 0 ? 
                                `<img src="${pcb.images[0]}" alt="${pcb.name}" class="w-24 h-24 object-cover rounded-md" />` : 
                                `<img src="https://placehold.co/96x96/cccccc/333333?text=No+Image" alt="No Image" class="w-24 h-24 object-cover rounded-md" />`}
                        </div>
                        <p class="${currentTheme === 'dark' ? 'text-green-300' : 'text-green-600'} mt-2">Potential Match (Requires visual verification)</p>
                    </div>
                `;
            });

            if (!foundMatches) {
                resultsHtml += `<p class="${currentTheme === 'dark' ? 'text-gray-400' : 'text-gray-500'}">No PCBs found in the database.</p>`;
            }

            comparisonResultsDiv.innerHTML = resultsHtml;
        });

        // Settings Section - Theme Change
        themeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                applyTheme(e.target.value);
            });
        });

        // Settings Section - Homepage Image Select
        homepageImageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onloadend = () => {
                    tempHomepageImage = reader.result;
                    settingsHomepageImagePreview.src = reader.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Settings Section - Set Homepage Image Button
        setHomepageImageBtn.addEventListener('click', () => {
            if (tempHomepageImage) {
                homepageImage = tempHomepageImage;
                localStorage.setItem('homepageImage', homepageImage);
                homepageImageStatusMessage.textContent = 'Homepage image set successfully!';
                homepageImageStatusMessage.className = 'mt-4 p-3 rounded-lg text-sm font-semibold bg-green-100 text-green-800';
                if (currentTheme === 'dark') {
                    homepageImageStatusMessage.classList.add('dark:bg-green-800', 'dark:text-green-100');
                }
                homepageImageStatusMessage.classList.remove('hidden');
                tempHomepageImage = null;
                homepageImageInput.value = '';

                setTimeout(() => {
                    homepageImageStatusMessage.classList.add('hidden');
                    homepageImageStatusMessage.textContent = '';
                }, 3000);
                updateHomepageImage(); // Update the image on the home page as well
            } else {
                homepageImageStatusMessage.textContent = 'Please select an image first.';
                homepageImageStatusMessage.className = 'mt-4 p-3 rounded-lg text-sm font-semibold bg-red-100 text-red-800';
                if (currentTheme === 'dark') {
                    homepageImageStatusMessage.classList.add('dark:bg-red-800', 'dark:text-red-100');
                }
                homepageImageStatusMessage.classList.remove('hidden');
                setTimeout(() => {
                    homepageImageStatusMessage.classList.add('hidden');
                    homepageImageStatusMessage.textContent = '';
                }, 3000);
            }
        });

        // Settings Section - Export Database to CSV
        exportCsvBtn.addEventListener('click', () => {
            if (pcbs.length === 0) {
                showMessage('No PCBs in the database to export to CSV.', 'error');
                return;
            }

            let csvContent = "PCB Name,Description,Images (Base64),Used By Family\n";
            pcbs.forEach(pcb => {
                const name = `"${(pcb.name || '').replace(/"/g, '""')}"`;
                const description = `"${(pcb.description || '').replace(/"/g, '""')}"`;
                const images = `"${(pcb.images && pcb.images.length > 0 ? pcb.images.map(img => img.replace(/"/g, '""')).join(' | ') : '')}"`; 
                const family = `"${(pcb.usedByFamily || '').replace(/"/g, '""')}"`; 
                csvContent += `${name},${description},${images},${family}\n`;
            });

            const csvBlob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            shareOrDownloadFile(csvBlob, 'pcb_report.csv', 'PCB Database CSV Report', 'Here is your PCB database in CSV format.');
        });

        // Settings Section - Import Database from CSV
        importFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                importFile = file;
                importStatusMessage.textContent = `File selected: ${file.name}`;
                importStatusMessage.className = 'mt-4 p-3 rounded-lg text-sm font-semibold bg-blue-100 text-blue-800';
                if (currentTheme === 'dark') {
                    importStatusMessage.classList.add('dark:bg-blue-800', 'dark:text-blue-100');
                }
                importStatusMessage.classList.remove('hidden');
            } else {
                importFile = null;
                importStatusMessage.textContent = 'No file selected.';
                importStatusMessage.className = 'mt-4 p-3 rounded-lg text-sm font-semibold bg-red-100 text-red-800';
                if (currentTheme === 'dark') {
                    importStatusMessage.classList.add('dark:bg-red-800', 'dark:text-red-100');
                }
                importStatusMessage.classList.remove('hidden');
            }
        });

        importDataBtn.addEventListener('click', () => {
            if (!importFile) {
                importStatusMessage.textContent = 'Please select a CSV file to import.';
                importStatusMessage.className = 'mt-4 p-3 rounded-lg text-sm font-semibold bg-red-100 text-red-800';
                if (currentTheme === 'dark') {
                    importStatusMessage.classList.add('dark:bg-red-800', 'dark:text-red-100');
                }
                importStatusMessage.classList.remove('hidden');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const csvText = e.target.result;
                try {
                    const importedPcbs = parseCsv(csvText);
                    pcbs = importedPcbs; // Overwrite existing data
                    localStorage.setItem('pcbs', JSON.stringify(pcbs));
                    importStatusMessage.textContent = `Successfully imported ${importedPcbs.length} PCBs.`;
                    importStatusMessage.className = 'mt-4 p-3 rounded-lg text-sm font-semibold bg-green-100 text-green-800';
                    if (currentTheme === 'dark') {
                        importStatusMessage.classList.add('dark:bg-green-800', 'dark:text-green-100');
                    }
                    importStatusMessage.classList.remove('hidden');
                    importFile = null;
                    importFileInput.value = '';
                } catch (error) {
                    importStatusMessage.textContent = `Error parsing CSV: ${error.message}`;
                    importStatusMessage.className = 'mt-4 p-3 rounded-lg text-sm font-semibold bg-red-100 text-red-800';
                    if (currentTheme === 'dark') {
                        importStatusMessage.classList.add('dark:bg-red-800', 'dark:text-red-100');
                    }
                    importStatusMessage.classList.remove('hidden');
                    console.error('Error parsing CSV:', error);
                } finally {
                    setTimeout(() => {
                        importStatusMessage.classList.add('hidden');
                        importStatusMessage.textContent = '';
                    }, 5000);
                }
            };
            reader.onerror = () => {
                importStatusMessage.textContent = 'Failed to read file.';
                importStatusMessage.className = 'mt-4 p-3 rounded-lg text-sm font-semibold bg-red-100 text-red-800';
                if (currentTheme === 'dark') {
                    importStatusMessage.classList.add('dark:bg-red-800', 'dark:text-red-100');
                }
                importStatusMessage.classList.remove('hidden');
                setTimeout(() => {
                    importStatusMessage.classList.add('hidden');
                    importStatusMessage.textContent = '';
                }, 3000);
            };
            reader.readAsText(importFile);
        });

        // Settings Section - Delete Database
        deleteDataPromptBtn.addEventListener('click', () => {
            showDeleteConfirmation = true;
            deleteConfirmationArea.classList.remove('hidden');
            deleteConfirmationMessage.textContent = 'WARNING: This will permanently delete all PCB data. Please backup your database using the "Export Database to CSV" option before proceeding. Are you sure you want to delete?';
            deleteConfirmationMessage.className = `mb-4 text-sm font-medium ${currentTheme === 'dark' ? 'text-red-300' : 'text-red-700'}`;
            deleteDataPromptBtn.classList.add('hidden');
            deleteStatusMessage.classList.add('hidden'); // Hide any previous status message
        });

        confirmDeleteBtn.addEventListener('click', () => {
            pcbs = []; // Clear all PCBs
            localStorage.removeItem('pcbs'); // Clear from local storage
            deleteStatusMessage.textContent = 'Database successfully deleted!';
            deleteStatusMessage.className = 'mt-4 p-3 rounded-lg text-sm font-semibold bg-green-100 text-green-800';
            if (currentTheme === 'dark') {
                deleteStatusMessage.classList.add('dark:bg-green-800', 'dark:text-green-100');
            }
            deleteStatusMessage.classList.remove('hidden');
            showDeleteConfirmation = false;
            deleteConfirmationArea.classList.add('hidden');
            deleteDataPromptBtn.classList.remove('hidden'); // Show delete button again

            setTimeout(() => {
                deleteStatusMessage.classList.add('hidden');
                deleteStatusMessage.textContent = '';
            }, 3000);
        });

        cancelDeleteBtn.addEventListener('click', () => {
            showDeleteConfirmation = false;
            deleteConfirmationArea.classList.add('hidden');
            deleteDataPromptBtn.classList.remove('hidden'); // Show delete button again
            deleteStatusMessage.classList.add('hidden'); // Hide any status message
            deleteStatusMessage.textContent = '';
        });

        // PDF Generation functions
        async function generatePdfReport(shareByEmail = false) {
            if (pcbs.length === 0) {
                showMessage('No PCBs in the database to generate a PDF report.', 'error');
                return;
            }

            const pdfContentElement = document.createElement('div');
            pdfContentElement.style.padding = '20px';
            pdfContentElement.style.fontFamily = 'sans-serif';
            pdfContentElement.innerHTML = `
                <h1 style="text-align: center; color: #333;">E2S PCB Database Report</h1>
                <p style="text-align: center; color: #555;">Generated on: ${new Date().toLocaleDateString()}</p>
                <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background-color: #f2f2f2;">
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">PCB Name</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Description</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Used By Family</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Image (First)</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${pcbs.map(pcb => `
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 8px;">${pcb.name || 'N/A'}</td>
                                <td style="border: 1px solid #ddd; padding: 8px;">${pcb.description || 'N/A'}</td>
                                <td style="border: 1px solid #ddd; padding: 8px;">${pcb.usedByFamily || 'N/A'}</td>
                                <td style="border: 1px solid #ddd; padding: 8px;">
                                    ${pcb.images && pcb.images.length > 0 ? 
                                        `<img src="${pcb.images[0]}" style="max-width: 80px; max-height: 80px; display: block;">` : 
                                        `No Image`}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.body.appendChild(pdfContentElement);

            try {
                const pdfBlob = await html2pdf().from(pdfContentElement).outputPdf('blob');
                
                if (shareByEmail) {
                    shareOrDownloadFile(pdfBlob, 'pcb_report.pdf', 'E2S PCB Report', 'Please find the attached PCB database report.');
                } else {
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(pdfBlob);
                    link.download = 'pcb_report.pdf';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(link.href);
                    showMessage('PDF report created and downloaded!', 'success');
                }
            } catch (error) {
                console.error('Error generating PDF:', error);
                showMessage('Error generating PDF: ' + error.message, 'error');
            } finally {
                document.body.removeChild(pdfContentElement);
            }
        }

        // Database Section PDF Buttons
        createPdfBtn.addEventListener('click', () => generatePdfReport(false));
        emailReportBtn.addEventListener('click', () => generatePdfReport(true));

        // About Us Collapsible Sections
        function setupCollapsible(headerElement, contentElement, svgElement) {
            headerElement.addEventListener('click', () => {
                const isExpanded = contentElement.style.maxHeight !== '0px' && contentElement.style.maxHeight !== '';
                if (isExpanded) {
                    contentElement.style.maxHeight = '0';
                    contentElement.style.opacity = '0';
                    svgElement.classList.remove('rotate-180');
                } else {
                    contentElement.style.maxHeight = contentElement.scrollHeight + 'px';
                    contentElement.style.opacity = '1';
                    svgElement.classList.add('rotate-180');
                }
            });
        }

        setupCollapsible(aboutUsCollapsible, aboutUsContent, document.querySelector('[data-toggle-svg="aboutUs"]'));
        setupCollapsible(servingSectorCollapsible, servingSectorContent, document.querySelector('[data-toggle-svg="servingSector"]'));
        setupCollapsible(productDevelopmentCollapsible, productDevelopmentContent, document.querySelector('[data-toggle-svg="productDevelopment"]'));

    </script>
</body>
</html>
